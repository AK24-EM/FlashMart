<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Collections Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .collection { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .count { font-weight: bold; color: #2563eb; }
        .error { color: #dc2626; background: #fef2f2; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .success { color: #059669; background: #f0fdf4; padding: 10px; border-radius: 5px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üîç Firebase Collections Data Test</h1>
    <div id="status">Testing Firebase collections...</div>
    <div id="results"></div>

    <!-- Firebase Configuration -->
    <script>
        window.FIREBASE_CONFIG = {
            apiKey: "AIzaSyB1hYkS2ucpOKdJWcOziJJ5kaT30b-eKow",
            authDomain: "flash-39282.firebaseapp.com",
            projectId: "flash-39282",
            storageBucket: "flash-39282.firebasestorage.app",
            messagingSenderId: "570627577471",
            appId: "1:570627577471:web:6e7a91ff2f62d6bda9d14a",
            measurementId: "G-SEHDJR5NSP"
        };
    </script>

    <script src="firebase-config.js"></script>
    <script src="scripts/firebase.js"></script>
    <script>
        async function testCollections() {
            const statusDiv = document.getElementById('status');
            const resultsDiv = document.getElementById('results');

            const collections = [
                { name: 'orders', displayName: 'Orders (Revenue Data)' },
                { name: 'users', displayName: 'Users (Customer Data)' },
                { name: 'products', displayName: 'Products (Catalog)' },
                { name: 'nps_responses', displayName: 'NPS Responses (Satisfaction)' }
            ];

            try {
                statusDiv.textContent = 'Initializing Firebase...';

                if (typeof firebaseService !== 'undefined') {
                    await firebaseService.initialize();
                    statusDiv.textContent = 'Firebase initialized successfully';

                    resultsDiv.innerHTML += '<div class="success">‚úÖ Firebase service available</div>';

                    if (firebaseService.db) {
                        resultsDiv.innerHTML += '<div class="success">‚úÖ Database instance available</div>';

                        for (const collection of collections) {
                            statusDiv.textContent = `Checking ${collection.displayName}...`;

                            try {
                                const snapshot = await firebaseService.db.collection(collection.name).limit(5).get();
                                const count = snapshot.size;
                                const docs = [];

                                snapshot.forEach(doc => {
                                    docs.push({ id: doc.id, ...doc.data() });
                                });

                                const collectionDiv = document.createElement('div');
                                collectionDiv.className = 'collection';

                                collectionDiv.innerHTML = `
                                    <h3>${collection.displayName}</h3>
                                    <p class="count">Documents: ${count}</p>
                                    <details>
                                        <summary>Sample Data (Click to expand)</summary>
                                        <pre>${JSON.stringify(docs, null, 2)}</pre>
                                    </details>
                                `;

                                resultsDiv.appendChild(collectionDiv);

                            } catch (error) {
                                const collectionDiv = document.createElement('div');
                                collectionDiv.className = 'collection';

                                collectionDiv.innerHTML = `
                                    <h3>${collection.displayName}</h3>
                                    <div class="error">‚ùå Error accessing collection: ${error.message}</div>
                                `;

                                resultsDiv.appendChild(collectionDiv);
                            }
                        }

                        statusDiv.textContent = '‚úÖ All collections tested';

                    } else {
                        resultsDiv.innerHTML += '<div class="error">‚ùå Database instance not available</div>';
                        statusDiv.textContent = '‚ùå Database connection failed';
                    }

                } else {
                    resultsDiv.innerHTML += '<div class="error">‚ùå Firebase service not loaded</div>';
                    statusDiv.textContent = '‚ùå Firebase service unavailable';
                }

            } catch (error) {
                resultsDiv.innerHTML += `<div class="error">‚ùå Error: ${error.message}</div>`;
                statusDiv.textContent = '‚ùå Firebase test failed';
                console.error('Firebase test error:', error);
            }
        }

        // Run test when page loads
        document.addEventListener('DOMContentLoaded', testCollections);
    </script>
</body>
</html>
